"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Popup=function(){function a(b){var c,d=this;return _classCallCheck(this,a),this.__uid=(new Date).getTime(),this.el=b.el,this.content=b.content,this.className=b.className,this.direction=b.direction||"bottom",this.popup=null,this.chevron=null,this.chevronWidth=b.chevronWidth||12,this.baseClass="dynamic-popup",this.contentBase=this.baseClass+"__content",this.chevronBase=this.baseClass+"__chevron",this.popupCustom=this.className||"",this.contentCustom=this.className?this.className+"__content":"",this.chevronCustom=this.className?this.className+"__chevron":"",this.position=function(){d._position()},this.onClickEl=function(){d._onClickEl()},this.onClickAnyWhere=function(a){d._onClickAnyWhere(a)},this.el.addEventListener("click",this.onClickEl),this.styles=(c={},_defineProperty(c,"."+this.baseClass,["position: absolute","padding: 10px","background: rgba(0, 0, 0, .85)","color: #fff","box-shadow: 2px 2px 10px rgba(0, 0, 0, .4)","webkit-transition: all .1s","transition: all .1s"]),_defineProperty(c,"."+this.contentBase+"\n      h1, h2, h3, h4, h4, h5, h6,\n      blockquote, pre, span\n      dl, dt, dd, ol, ul, li,\n      table, caption, tbody, tfoot,\n      thead, tr, th, td,\n      p, img, ul, ol, dl li",["margin: 0","padding: 0"]),_defineProperty(c,"."+this.chevronBase,["position: absolute","color: rgba(0, 0, 0, .85)"]),c),this.stylize(),this}return _createClass(a,[{key:"bindEvents",value:function(){window.addEventListener("resize",this.position),window.addEventListener("scroll",this.position),document.body.addEventListener("click",this.onClickAnyWhere)}},{key:"unbindEvents",value:function(){window.removeEventListener("resize",this.position),window.removeEventListener("scroll",this.position),document.body.removeEventListener("click",this.onClickAnyWhere)}},{key:"stylize",value:function(){function a(a,b,c,d){"insertRule"in a?a.insertRule(b+"{"+c+"}",d):"addRule"in a&&a.addRule(b,c,d)}var b="dynamic-popup-styles",c=document.getElementById(b);if(!c){var d=function(){var a=document.createElement("style");return a.id=b,a.appendChild(document.createTextNode("")),document.head.insertBefore(a,document.head.firstChild),a.sheet}();for(var e in this.styles)if(this.styles.hasOwnProperty(e)){var f=!0,g=!1,h=void 0;try{for(var i,j=this.styles[e][Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k=i.value;a(d,e,k)}}catch(l){g=!0,h=l}finally{try{!f&&j["return"]&&j["return"]()}finally{if(g)throw h}}}}}},{key:"destroy",value:function(){this.popup&&(this.unbindEvents(),this.popup.parentNode.removeChild(this.popup),this.popup=null,this.chevron=null)}},{key:"_onClickEl",value:function(){this.popup?this.popup&&this.destroy():(this.render(),this.bindEvents())}},{key:"_onClickAnyWhere",value:function(a){var b=this;if(this.popup){var c=a.target,d=this._dir(c,"parentNode");d.push(c);var e=d.filter(function(a){return a==b.el}).length,f=d.filter(function(a){return a==b.popup}).length;f||e||this.destroy()}}},{key:"_dir",value:function(a,b){for(var c=[];(a=a[b])&&9!==a.nodeType;)1===a.nodeType&&c.push(a);return c}},{key:"_position",value:function(){var a=this.el,b=this.popup,c=this.direction,d=a.offsetTop,e=a.offsetLeft,f=a.offsetWidth,g=a.offsetHeight,h=b.offsetTop,i=b.offsetWidth,j=b.offsetHeight,k=Math.max(document.body.scrollTop,document.documentElement.scrollTop),l=10,m=this.chevronWidth,n={top:d-j-l,bottom:d+g+l,left:d+g/2-j/2,right:d+g/2-j/2},o={top:e+f/2-i/2,bottom:e+f/2-i/2,left:e-i-l,right:e+f+l},p={top:{top:"auto",bottom:"-"+m+"px",left:e-o.top+f/2+"px","-webkit-transform":"rotate(180deg)",transform:"rotate(180deg)"},bottom:{bottom:"auto",top:"-"+m+"px",left:e-o.top+f/2+"px","-webkit-transform":"rotate(0deg)",transform:"rotate(0deg)"},left:{bottom:"auto",top:d-h+g/2+"px",left:i+"px","-webkit-transform":"rotate(90deg)",transform:"rotate(90deg)"},right:{bottom:"auto",top:d-h+g/2+"px",left:"-"+m+"px","-webkit-transform":"rotate(-90deg)",transform:"rotate(-90deg)"}},q=o[c],r=n[c],s=p[c];if(0>=q&&(("top"===c||"bottom"===c)&&(q-=q,s.left=e+f/2+"px"),"left"===this.direction&&(q=o.right,s=p.right)),q+i>=window.innerWidth&&(("top"===c||"bottom"===c)&&(q+=window.innerWidth-(q+i)),"right"===c&&o.left>0&&(q=o.left,s=p.left)),0>=r-k){if("right"===c||"left"===c){var t=k-r;t>j/4||(r+=t)}"top"===c&&(r=n.bottom,s=p.bottom)}if(r+j-k>=window.innerHeight){if("right"===c||"left"===c){var t=r+j-k-window.innerHeight;t>j/4||(r-=t)}"bottom"===c&&(r=n.top,s=p.top)}for(var u in s)s.hasOwnProperty(u)&&(this.chevron.style[u]=s[u]);this.popup.style.left=q+"px",this.popup.style.top=r+"px"}},{key:"render",value:function(){this.popup=document.createElement("div"),this.popup.classList.add(this.baseClass,this.popupCustom),this.popup.setAttribute("data-dynamic-popup",this.__uid);var a=document.createElement("div");a.classList.add(this.contentBase,this.contentCustom),a.style.position="relative",a.innerHTML=this.content,this.chevron=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.chevron.setAttribute("width",""+this.chevronWidth),this.chevron.setAttribute("height",""+this.chevronWidth),this.chevron.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.chevron.classList.add(this.chevronBase,this.chevronCustom);var b=document.createElementNS("http://www.w3.org/2000/svg","polygon");b.setAttribute("points",this.chevronWidth/2+","+this.chevronWidth/1.8+" 0,"+this.chevronWidth+" "+this.chevronWidth+","+this.chevronWidth),b.setAttribute("style","fill:currentColor"),this.chevron.appendChild(b),this.popup.appendChild(a),this.popup.appendChild(this.chevron),document.body.appendChild(this.popup),this.position()}}]),a}();