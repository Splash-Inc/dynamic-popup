"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(a){if("function"==typeof bootstrap)bootstrap("DynamicPopup",a);else if("object"==typeof exports&&"object"==typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeDynamicPopup=a}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by DynamicPopup. Please file a bug.");var b="undefined"!=typeof window?window:self,c=b.DynamicPopup;b.DynamicPopup=a(),b.DynamicPopup.noConflict=function(){return b.DynamicPopup=c,this}}}(function(){var a=function(){function a(b){var c,d=this;return _classCallCheck(this,a),this.__uid=(new Date).getTime(),this.el=b.el,this.content=b.content,this.classes="string"==typeof b.className?[b.className]:b.className,this.direction=b.direction||"bottom",this.popup=null,this.chevron=null,this.chevronWidth=b.chevronWidth||12,this.prefetch=b.prefetch,this.baseClass="dynamic-popup",this.contentBase=this.baseClass+"__content",this.chevronBase=this.baseClass+"__chevron",this.position=function(){d._position()},this.onClickEl=function(){d._onClickEl()},this.onClickAnyWhere=function(a){d._onClickAnyWhere(a)},this.el.addEventListener("click",this.onClickEl),this.styles=(c={},_defineProperty(c,"."+this.baseClass,["position: absolute","padding: 10px","background: rgba(0, 0, 0, .85)","color: #fff","box-shadow: 2px 2px 10px rgba(0, 0, 0, .4)","webkit-transition: all .1s","transition: all .1s"]),_defineProperty(c,"."+this.contentBase+"\n        h1, h2, h3, h4, h4, h5, h6,\n        blockquote, pre, span\n        dl, dt, dd, ol, ul, li,\n        table, caption, tbody, tfoot,\n        thead, tr, th, td,\n        p, img, ul, ol, dl li",["margin: 0","padding: 0"]),_defineProperty(c,"."+this.chevronBase,["position: absolute","color: rgba(0, 0, 0, .85)"]),c),this.stylize(),this.prefetch&&this.preFetchResources(),this}return _createClass(a,[{key:"bindEvents",value:function(){window.addEventListener("resize",this.position),window.addEventListener("scroll",this.position),document.body.addEventListener("click",this.onClickAnyWhere)}},{key:"unbindEvents",value:function(){window.removeEventListener("resize",this.position),window.removeEventListener("scroll",this.position),document.body.removeEventListener("click",this.onClickAnyWhere)}},{key:"stylize",value:function(){function a(a,b,c,d){"insertRule"in a?a.insertRule(b+"{"+c+"}",d):"addRule"in a&&a.addRule(b,c,d)}var b="dynamic-popup-styles",c=document.getElementById(b);if(!c){var d=function(){var a=document.createElement("style");return a.id=b,a.appendChild(document.createTextNode("")),document.head.insertBefore(a,document.head.firstChild),a.sheet}();for(var e in this.styles)if(this.styles.hasOwnProperty(e)){var f=!0,g=!1,h=void 0;try{for(var i,j=this.styles[e][Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k=i.value;a(d,e,k)}}catch(l){g=!0,h=l}finally{try{!f&&j["return"]&&j["return"]()}finally{if(g)throw h}}}}}},{key:"preFetchResources",value:function(){var a=document.createElement("div");a.innerHTML=this.content;var b=[].slice.call(a.querySelectorAll("img")),c=!0,d=!1,e=void 0;try{for(var f,g=b[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value,i=new Image;i.src=h.src}}catch(j){d=!0,e=j}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}}},{key:"render",value:function(){this.popup=document.createElement("div"),this.popup.setAttribute("data-dynamic-popup",this.__uid),this.popup.classList.add(this.baseClass),this.popupContent=document.createElement("div"),this.popupContent.style.position="relative",this.popupContent.innerHTML=this.content,this.popupContent.classList.add(this.contentBase),this.chevron=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.chevron.setAttribute("width",""+this.chevronWidth),this.chevron.setAttribute("height",""+this.chevronWidth),this.chevron.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.chevron.classList.add(this.chevronBase);var a=document.createElementNS("http://www.w3.org/2000/svg","polygon");a.setAttribute("points",this.chevronWidth/2+","+this.chevronWidth/1.8+" 0,"+this.chevronWidth+" "+this.chevronWidth+","+this.chevronWidth),a.setAttribute("style","fill:currentColor"),this.chevron.appendChild(a);var b=!0,c=!1,d=void 0;try{for(var e,f=this.classes[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;this.popup.classList.add(g),this.popupContent.classList.add(g+"__content"),this.chevron.classList.add(g+"__chevron")}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}this.popup.appendChild(this.popupContent),this.popup.appendChild(this.chevron),document.body.appendChild(this.popup),this.position()}},{key:"destroy",value:function(){this.popup&&(this.unbindEvents(),this.popup.parentNode.removeChild(this.popup),this.popup=null,this.chevron=null)}},{key:"_onClickEl",value:function(){this.popup?this.popup&&this.destroy():(this.render(),this.bindEvents())}},{key:"_onClickAnyWhere",value:function(a){var b=this;if(this.popup){var c=a.target,d=this._dir(c,"parentNode");d.push(c);var e=d.filter(function(a){return a==b.el}).length,f=d.filter(function(a){return a==b.popup}).length;f||e||this.destroy()}}},{key:"_dir",value:function(a,b){for(var c=[];(a=a[b])&&9!==a.nodeType;)1===a.nodeType&&c.push(a);return c}},{key:"_position",value:function(){var a=this.el,b=this.popup,c=this.direction,d=Math.max(document.body.scrollTop,document.documentElement.scrollTop),e=Math.max(document.body.scrollLeft,document.documentElement.scrollLeft),f=window.innerWidth,g=window.innerHeight,h=a.getBoundingClientRect(),i=b.getBoundingClientRect(),j=h.top+d,k=h.left+e,l=h.width,m=h.height,n=i.width,o=i.height,p=10,q=this.chevronWidth,r={top:j-o-p,bottom:j+m+p,left:j+m/2-o/2,right:j+m/2-o/2},s={top:k+l/2-n/2,bottom:k+l/2-n/2,left:k-n-p,right:k+l+p},t={top:{top:"auto",bottom:"-"+q+"px",left:k-s.top+l/2-q/2+"px","-webkit-transform":"rotate(180deg)",transform:"rotate(180deg)"},bottom:{bottom:"auto",top:"-"+q+"px",left:k-s.top+l/2-q/2+"px","-webkit-transform":"rotate(0deg)",transform:"rotate(0deg)"},left:{bottom:"auto",top:o/2-q/2+"px",left:n+"px","-webkit-transform":"rotate(90deg)",transform:"rotate(90deg)"},right:{bottom:"auto",top:o/2-q/2+"px",left:"-"+q+"px","-webkit-transform":"rotate(-90deg)",transform:"rotate(-90deg)"}},u=s[c],v=r[c],w=t[c],x=0>=u,y=u+n>=f,z=0>=v-d,A=v+o-d>=g;if(x&&(("top"===c||"bottom"===c)&&(u-=u,w.left=k+l/2-q/2+"px"),"left"===this.direction&&(u=s.right,w=t.right)),y&&(("top"===c||"bottom"===c)&&(u+=f-(u+n),w.left=k-u+l/2-q/2+"px"),"right"===c&&s.left>0&&(u=s.left,w=t.left)),z){if("right"===c||"left"===c){var B=d-v;B>o/4||(v+=B,w.top=parseInt(w.top,10)-B+"px")}if("top"===c){v=r.bottom;var C=w.left;w=t.bottom,w.left=C}}if(A){if("right"===c||"left"===c){var B=v+o-d-g;B>o/4||(v-=B,w.top=parseInt(w.top,10)+B+"px")}if("bottom"===c){v=r.top;var C=w.left;w=t.top,w.left=C}}for(var D in w)w.hasOwnProperty(D)&&(this.chevron.style[D]=w[D]);this.popup.style.left=u+"px",this.popup.style.top=v+"px"}}]),a}();return a});